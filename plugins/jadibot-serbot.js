/*⚠ PROHIBIDO EDITAR ⚠

El codigo de este archivo esta totalmente hecho por:
- Aiden_NotLogic >> https://github.com/ferhacks

El codigo de este archivo fue parchado por:
- ReyEndymion >> https://github.com/ReyEndymion
- BrunoSobrino >> https://github.com/BrunoSobrino

Contenido adaptado por:
- GataNina-Li >> https://github.com/GataNina-Li
- elrebelde21 >> https://github.com/elrebelde21
*/

//const _0x42ab3a=_0x120c;(function(_0x42370f,_0x4ae1dc){const _0x4490a3=_0x120c,_0x339bff=_0x42370f();while(!![]){try{const _0x194861=-parseInt(_0x4490a3(0x22e))/0x1*(-parseInt(_0x4490a3(0x225))/0x2)+-parseInt(_0x4490a3(0x1cf))/0x3+-parseInt(_0x4490a3(0x23d))/0x4*(-parseInt(_0x4490a3(0x224))/0x5)+-parseInt(_0x4490a3(0x242))/0x6+-parseInt(_0x4490a3(0x202))/0x7+parseInt(_0x4490a3(0x1d0))/0x8*(parseInt(_0x4490a3(0x208))/0x9)+parseInt(_0x4490a3(0x1cb))/0xa;if(_0x194861===_0x4ae1dc)break;else _0x339bff['push'](_0x339bff['shift']());}catch(_0x1306b0){_0x339bff['push'](_0x339bff['shift']());}}}(_0x4734,0xae89b));const {useMultiFileAuthState,DisconnectReason,makeCacheableSignalKeyStore,fetchLatestBaileysVersion}=await import(global['baileys']);import _0x12e4e2 from'qrcode';import _0x4b6517 from'node-cache';import _0x1b3c69 from'fs';import _0x267f3e from'path';import _0xb26b51 from'pino';import _0xc5630f from'util';import*as _0x192334 from'ws';function _0x120c(_0x1fa83a,_0x118aa2){const _0x4734c3=_0x4734();return _0x120c=function(_0x120c21,_0x203dac){_0x120c21=_0x120c21-0x1c6;let _0x10610f=_0x4734c3[_0x120c21];return _0x10610f;},_0x120c(_0x1fa83a,_0x118aa2);}const {child,spawn,exec}=await import(_0x42ab3a(0x1d5)),{CONNECTING}=_0x192334;import{makeWASocket}from'../lib/simple.js';let check1=_0x42ab3a(0x1fc),check2=_0x42ab3a(0x1fe),check3=_0x42ab3a(0x211),check4=_0x42ab3a(0x1f2),check5=_0x42ab3a(0x204),check6=_0x42ab3a(0x20a),check8=_0x42ab3a(0x213),crm1=_0x42ab3a(0x1db),crm2=_0x42ab3a(0x206),crm3='SBpbmZvLWRvbmFyLmpz',crm4=_0x42ab3a(0x21e),drm1=_0x42ab3a(0x1f4),drm2=_0x42ab3a(0x1dd),rtx=''+lenguajeGB['smsIniJadi'](),rtx2=''+lenguajeGB[_0x42ab3a(0x205)]();if(global[_0x42ab3a(0x234)]instanceof Array)console[_0x42ab3a(0x20f)]();else global['conns']=[];function _0x4734(){const _0x2a84e6=['groupsUpdate','isInit','smsConexiondescon','smsSdemote','call','register','stringify','user','mkdirSync','group-participants.update','toString','m8tZG9uYXIuanMK','smsreenvia','CkphZGlib3QsIEhlY2hv','/creds.json','conn','smsBye','splice','sendMessage','data','catch','NjBhZGVmZWI4N2M2','Omitiendo\x20mensajes\x20en\x20espera.','ZThkMmNkOGVlMDFmZD','statusCode','jadibot','onDelete','3182361msBcey','../handler.js','NzZjM2ZmMzU2MTEyMzM3OTczOWU5ZmFmMDZjYzUzO','smsIniJadi2','A7IG1kNXN1b','writeFileSync','1420029MjpUhw','rentbot','DcgIF9hdXRvcmVzcG9uZGVyLmpzCjU5Yzc0ZjFjNmEz','smsJBConexion','bind','smsConexiontiem','chats','log','indexOf','UzYTI1MTQgIGluZ','\x20wa.me/','NjNmYmJjYzA1YmFiY2MzZGU4MGRlICBpbmZvLWJvdC5qcwo','GataBot\x20-\x20Sub\x20Bot','sIcon','welcome','sender','getcode','fromMe','smsJBConexionClose','removeAllListeners','credsUpdate','sdemote','IF9hdXRvcmVzcG9uZGVyLmpzIGluZm8tYm90Lmpz','smsJBPrincipal','off','jadibotmd','includes','command','5izwYvs','38940LrYgVn','getTime','participantsUpdate','smsSrevoke','groups.update','smsSpromote','smsSdesc','message.delete','--code','13BkmolP','unlinkSync','close','&text=','spromote','from','conns','creds.update','2.0.0','smsJBConexionClose2','smsJBConexionTrue2','existsSync','parse','trim','reply','1138476NrtLMR','keys','readFileSync','badSession','silent','3724458rUgLZI','tags','toBuffer','messages.upsert','smsSicon','bye','onCall','isBanned','Chrome','jid','connection.update','Leyendo\x20mensaje\x20entrante:','requestPairingCode','loggedOut','base64','handler','15478830KAEZHG','sRevoke','sSubject','connectionLost','1359360TYCrAj','8ovJqcs','../handler.js?update=','smsSoloOwnerJB','utf-8','split','child_process','registered','mentionedJid','chat','output','length','Y2QgcGx1Z2lucy','sDesc','IHBvciBAQWlkZW5fTm90TG9naWM','replace','payload','./GataJadiBot/','110.0.5585.95','GataBot-MD','error','smsJBCargando','connectionUpdate','serbot'];_0x4734=function(){return _0x2a84e6;};return _0x4734();}let handler=async(_0x1db94b,{conn:_0x15d4c7,args:_0x41f9dd,usedPrefix:_0x16e163,command:_0x50429b,isOwner:_0x51fda8})=>{const _0x81dc2=_0x42ab3a;if(!global['db'][_0x81dc2(0x1fa)]['settings'][_0x15d4c7[_0x81dc2(0x1ee)][_0x81dc2(0x24b)]][_0x81dc2(0x221)])return _0x1db94b[_0x81dc2(0x23c)](''+lenguajeGB[_0x81dc2(0x1d2)]());let _0x1f1ef1=_0x15d4c7;if(_0x15d4c7[_0x81dc2(0x1ee)][_0x81dc2(0x24b)]!==global[_0x81dc2(0x1f6)][_0x81dc2(0x1ee)][_0x81dc2(0x24b)])return _0x1f1ef1['reply'](_0x1db94b[_0x81dc2(0x1d8)],lenguajeGB[_0x81dc2(0x21f)]()+_0x81dc2(0x212)+global[_0x81dc2(0x1f6)]['user'][_0x81dc2(0x24b)][_0x81dc2(0x1d4)]`@`[0x0]+_0x81dc2(0x231)+(_0x16e163+_0x50429b),_0x1db94b);const _0x3c1bb8=_0x41f9dd[0x0]&&_0x41f9dd[0x0][_0x81dc2(0x222)](_0x81dc2(0x22d))?!![]:_0x41f9dd[0x1]&&_0x41f9dd[0x1][_0x81dc2(0x222)](_0x81dc2(0x22d))?!![]:![];let _0x4c2db5=_0x1db94b[_0x81dc2(0x1d7)]&&_0x1db94b['mentionedJid'][0x0]?_0x1db94b[_0x81dc2(0x1d7)][0x0]:_0x1db94b['fromMe']?_0x1f1ef1[_0x81dc2(0x1ee)]['jid']:_0x1db94b['sender'],_0x246566=''+_0x4c2db5['split']`@`[0x0];if(_0x3c1bb8){_0x41f9dd[0x0]=_0x41f9dd[0x0][_0x81dc2(0x1de)]('--code','')[_0x81dc2(0x23b)]();if(_0x41f9dd[0x1])_0x41f9dd[0x1]=_0x41f9dd[0x1][_0x81dc2(0x1de)](_0x81dc2(0x22d),'')['trim']();if(_0x41f9dd[0x0]=='')_0x41f9dd[0x0]=undefined;console[_0x81dc2(0x20f)](_0x41f9dd[0x0]);}!_0x1b3c69[_0x81dc2(0x239)](_0x81dc2(0x1e0)+_0x246566)&&_0x1b3c69[_0x81dc2(0x1ef)]('./GataJadiBot/'+_0x246566,{'recursive':!![]});_0x41f9dd[0x0]&&_0x41f9dd[0x0]!=undefined?_0x1b3c69['writeFileSync'](_0x81dc2(0x1e0)+_0x246566+_0x81dc2(0x1f5),JSON[_0x81dc2(0x1ed)](JSON[_0x81dc2(0x23a)](Buffer[_0x81dc2(0x233)](_0x41f9dd[0x0],_0x81dc2(0x1c9))[_0x81dc2(0x1f1)](_0x81dc2(0x1d3))),null,'\x09')):'';if(_0x1b3c69[_0x81dc2(0x239)](_0x81dc2(0x1e0)+_0x246566+_0x81dc2(0x1f5))){let _0x566201=JSON[_0x81dc2(0x23a)](_0x1b3c69[_0x81dc2(0x23f)](_0x81dc2(0x1e0)+_0x246566+_0x81dc2(0x1f5)));_0x566201&&((_0x566201[_0x81dc2(0x1d6)]=![])&&_0x1b3c69[_0x81dc2(0x22f)](_0x81dc2(0x1e0)+_0x246566+_0x81dc2(0x1f5)));}const _0x301689=Buffer[_0x81dc2(0x233)](crm1+crm2+crm3+crm4,'base64');exec(_0x301689[_0x81dc2(0x1f1)](_0x81dc2(0x1d3)),async(_0x94dde0,_0x20574d,_0x26e932)=>{const _0x47cf37=_0x81dc2,_0x3e5ea9=Buffer[_0x47cf37(0x233)](drm1+drm2,_0x47cf37(0x1c9));async function _0x3f6051(){const _0x50827a=_0x47cf37;let _0x25ab59=_0x1db94b['mentionedJid']&&_0x1db94b[_0x50827a(0x1d7)][0x0]?_0x1db94b['mentionedJid'][0x0]:_0x1db94b[_0x50827a(0x219)]?_0x1f1ef1[_0x50827a(0x1ee)]['jid']:_0x1db94b[_0x50827a(0x217)],_0x22bb22=''+_0x25ab59[_0x50827a(0x1d4)]`@`[0x0];!_0x1b3c69[_0x50827a(0x239)](_0x50827a(0x1e0)+_0x22bb22)&&_0x1b3c69['mkdirSync'](_0x50827a(0x1e0)+_0x22bb22,{'recursive':!![]});_0x41f9dd[0x0]?_0x1b3c69[_0x50827a(0x207)](_0x50827a(0x1e0)+_0x22bb22+_0x50827a(0x1f5),JSON[_0x50827a(0x1ed)](JSON[_0x50827a(0x23a)](Buffer['from'](_0x41f9dd[0x0],'base64')['toString']('utf-8')),null,'\x09')):'';let {version:_0x13934b,isLatest:_0xf94080}=await fetchLatestBaileysVersion();const _0x2abe77=_0x597bfa=>{},_0x3ef11=new _0x4b6517(),{state:_0x477821,saveState:_0x26214a,saveCreds:_0x29a03b}=await useMultiFileAuthState(_0x50827a(0x1e0)+_0x22bb22),_0x391581={'printQRInTerminal':![],'logger':_0xb26b51({'level':_0x50827a(0x241)}),'auth':{'creds':_0x477821['creds'],'keys':makeCacheableSignalKeyStore(_0x477821[_0x50827a(0x23e)],_0xb26b51({'level':_0x50827a(0x241)}))},'msgRetry':_0x2abe77,'msgRetryCache':_0x3ef11,'version':_0x13934b,'syncFullHistory':!![],'browser':_0x3c1bb8?['Ubuntu',_0x50827a(0x24a),_0x50827a(0x1e1)]:[_0x50827a(0x214),'Chrome',_0x50827a(0x236)],'defaultQueryTimeoutMs':undefined,'getMessage':async _0x348f61=>{const _0x1146b8=_0x50827a;if(store){}return{'conversation':_0x1146b8(0x1e2)};}};let _0xf3d377=makeWASocket(_0x391581);_0xf3d377[_0x50827a(0x1e8)]=![];let _0x290202=!![];async function _0x2de2d2(_0x2c4023){const _0x196f81=_0x50827a,{connection:_0x3905e1,lastDisconnect:_0x110d9d,isNewLogin:_0x24883d,qr:_0x44c7e5}=_0x2c4023;if(_0x24883d)_0xf3d377[_0x196f81(0x1e8)]=![];if(_0x44c7e5&&!_0x3c1bb8)return _0x1f1ef1[_0x196f81(0x1f9)](_0x1db94b[_0x196f81(0x1d8)],{'image':await _0x12e4e2[_0x196f81(0x244)](_0x44c7e5,{'scale':0x8}),'caption':rtx+_0x3e5ea9[_0x196f81(0x1f1)](_0x196f81(0x1d3))},{'quoted':_0x1db94b});if(_0x44c7e5&&_0x3c1bb8){_0x1f1ef1['sendMessage'](_0x1db94b[_0x196f81(0x1d8)],{'text':rtx2+_0x3e5ea9['toString'](_0x196f81(0x1d3))},{'quoted':_0x1db94b}),await sleep(0x1388);let _0x177199=await _0xf3d377[_0x196f81(0x1c7)](_0x1db94b[_0x196f81(0x217)]['split']`@`[0x0]);await _0x1db94b[_0x196f81(0x23c)](_0x177199);}const _0x528604=_0x110d9d?.['error']?.[_0x196f81(0x1d9)]?.[_0x196f81(0x1ff)]||_0x110d9d?.['error']?.[_0x196f81(0x1d9)]?.[_0x196f81(0x1df)]?.[_0x196f81(0x1ff)];console[_0x196f81(0x20f)](_0x528604);const _0x480a7f=async _0x1a17bf=>{const _0x1ba026=_0x196f81;if(!_0x1a17bf){try{_0xf3d377['ws'][_0x1ba026(0x230)]();}catch{}_0xf3d377['ev'][_0x1ba026(0x21b)]();let _0x2d5e07=global[_0x1ba026(0x234)][_0x1ba026(0x210)](_0xf3d377);if(_0x2d5e07<0x0)return;delete global[_0x1ba026(0x234)][_0x2d5e07],global[_0x1ba026(0x234)][_0x1ba026(0x1f8)](_0x2d5e07,0x1);}},_0x4981e1=_0x110d9d?.['error']?.[_0x196f81(0x1d9)]?.['statusCode']||_0x110d9d?.[_0x196f81(0x1e3)]?.[_0x196f81(0x1d9)]?.[_0x196f81(0x1df)]?.['statusCode'];if(_0x3905e1===_0x196f81(0x230)){console['log'](_0x4981e1);if(_0x4981e1==0x195)return await _0x1b3c69[_0x196f81(0x22f)](_0x196f81(0x1e0)+_0x22bb22+_0x196f81(0x1f5)),await _0x1db94b[_0x196f81(0x23c)](lenguajeGB[_0x196f81(0x1f3)]());if(_0x4981e1===DisconnectReason['restartRequired'])return _0x3f6051(),console[_0x196f81(0x20f)](lenguajeGB['smsConexionreem']());else{if(_0x4981e1===DisconnectReason[_0x196f81(0x1c8)])return sleep(0xfa0),_0x1db94b[_0x196f81(0x23c)](lenguajeGB[_0x196f81(0x237)]());else{if(_0x4981e1==0x1ac)return await _0x480a7f(![]),_0x1db94b['reply'](lenguajeGB[_0x196f81(0x20b)]());else{if(_0x4981e1===DisconnectReason[_0x196f81(0x1ce)])return await _0x3f6051(),console['log'](lenguajeGB['smsConexionperdida']());else{if(_0x4981e1===DisconnectReason[_0x196f81(0x240)])return await _0x1db94b['reply'](lenguajeGB[_0x196f81(0x21a)]());else{if(_0x4981e1===DisconnectReason['timedOut'])return await _0x480a7f(![]),console[_0x196f81(0x20f)](lenguajeGB[_0x196f81(0x20d)]());else console[_0x196f81(0x20f)](lenguajeGB[_0x196f81(0x1e9)]());}}}}}}if(global['db'][_0x196f81(0x1fa)]==null)loadDatabase();if(_0x3905e1=='open'){_0xf3d377[_0x196f81(0x1e8)]=!![],global['conns']['push'](_0xf3d377),await _0x1f1ef1['sendMessage'](_0x1db94b[_0x196f81(0x1d8)],{'text':_0x41f9dd[0x0]?''+lenguajeGB[_0x196f81(0x1e4)](_0x16e163):''+lenguajeGB[_0x196f81(0x238)]()+('\x20'+(_0x16e163+_0x50429b))},{'quoted':_0x1db94b}),await sleep(0x1388);if(!_0x41f9dd[0x0])_0x1f1ef1['sendMessage'](_0x1db94b['chat'],{'text':_0x16e163+_0x50429b+'\x20'+Buffer[_0x196f81(0x233)](_0x1b3c69[_0x196f81(0x23f)](_0x196f81(0x1e0)+_0x22bb22+_0x196f81(0x1f5)),_0x196f81(0x1d3))[_0x196f81(0x1f1)](_0x196f81(0x1c9))},{'quoted':_0x1db94b});}}setInterval(async()=>{const _0x370098=_0x50827a;if(!_0xf3d377[_0x370098(0x1ee)]){try{_0xf3d377['ws'][_0x370098(0x230)]();}catch(_0x278c7b){console['log'](await _0x5591f8(!![])[_0x370098(0x1fb)](console[_0x370098(0x1e3)]));}_0xf3d377['ev'][_0x370098(0x21b)]();let _0x4ae115=global['conns'][_0x370098(0x210)](_0xf3d377);if(_0x4ae115<0x0)return;delete global[_0x370098(0x234)][_0x4ae115],global['conns']['splice'](_0x4ae115,0x1);}},0xea60);let _0x129260=await import(_0x50827a(0x203)),_0x5591f8=async function(_0x4056bf){const _0x272bbc=_0x50827a;try{const _0x4b007b=await import(_0x272bbc(0x1d1)+Date['now']())['catch'](console[_0x272bbc(0x1e3)]);if(Object[_0x272bbc(0x23e)](_0x4b007b||{})[_0x272bbc(0x1da)])_0x129260=_0x4b007b;}catch(_0xcf8594){console[_0x272bbc(0x1e3)](_0xcf8594);}if(_0x4056bf){const _0x163d77=_0xf3d377[_0x272bbc(0x20e)];try{_0xf3d377['ws'][_0x272bbc(0x230)]();}catch{}_0xf3d377['ev'][_0x272bbc(0x21b)](),_0xf3d377=makeWASocket(_0x391581,{'chats':_0x163d77}),_0x290202=!![];}!_0x290202&&(_0xf3d377['ev'][_0x272bbc(0x220)]('messages.upsert',_0xf3d377['handler']),_0xf3d377['ev'][_0x272bbc(0x220)](_0x272bbc(0x1f0),_0xf3d377[_0x272bbc(0x227)]),_0xf3d377['ev'][_0x272bbc(0x220)](_0x272bbc(0x229),_0xf3d377['groupsUpdate']),_0xf3d377['ev'][_0x272bbc(0x220)](_0x272bbc(0x22c),_0xf3d377[_0x272bbc(0x201)]),_0xf3d377['ev'][_0x272bbc(0x220)](_0x272bbc(0x1eb),_0xf3d377['onCall']),_0xf3d377['ev'][_0x272bbc(0x220)](_0x272bbc(0x24c),_0xf3d377[_0x272bbc(0x1e5)]),_0xf3d377['ev'][_0x272bbc(0x220)](_0x272bbc(0x235),_0xf3d377['credsUpdate']));_0xf3d377[_0x272bbc(0x216)]=lenguajeGB['smsWelcome'](),_0xf3d377[_0x272bbc(0x247)]=lenguajeGB[_0x272bbc(0x1f7)](),_0xf3d377[_0x272bbc(0x232)]=lenguajeGB[_0x272bbc(0x22a)](),_0xf3d377[_0x272bbc(0x21d)]=lenguajeGB[_0x272bbc(0x1ea)](),_0xf3d377[_0x272bbc(0x1dc)]=lenguajeGB[_0x272bbc(0x22b)](),_0xf3d377[_0x272bbc(0x1cd)]=lenguajeGB['smsSsubject'](),_0xf3d377[_0x272bbc(0x215)]=lenguajeGB[_0x272bbc(0x246)](),_0xf3d377[_0x272bbc(0x1cc)]=lenguajeGB[_0x272bbc(0x228)](),_0xf3d377[_0x272bbc(0x1ca)]=_0x129260[_0x272bbc(0x1ca)][_0x272bbc(0x20c)](_0xf3d377),_0xf3d377[_0x272bbc(0x227)]=_0x129260['participantsUpdate'][_0x272bbc(0x20c)](_0xf3d377),_0xf3d377[_0x272bbc(0x1e7)]=_0x129260[_0x272bbc(0x1e7)][_0x272bbc(0x20c)](_0xf3d377),_0xf3d377[_0x272bbc(0x201)]=_0x129260['deleteUpdate'][_0x272bbc(0x20c)](_0xf3d377),_0xf3d377['onCall']=_0x129260['callUpdate'][_0x272bbc(0x20c)](_0xf3d377),_0xf3d377['connectionUpdate']=_0x2de2d2[_0x272bbc(0x20c)](_0xf3d377),_0xf3d377[_0x272bbc(0x21c)]=_0x29a03b[_0x272bbc(0x20c)](_0xf3d377,!![]);const _0x1b4f9c=new Date(),_0x555ac5=new Date(_0xf3d377['ev']*0x3e8);return _0x1b4f9c[_0x272bbc(0x226)]()-_0x555ac5[_0x272bbc(0x226)]()<=0x493e0?(console['log'](_0x272bbc(0x1c6),_0xf3d377['ev']),Object[_0x272bbc(0x23e)](_0xf3d377['chats'])['forEach'](_0x2afbd0=>{const _0x284b98=_0x272bbc;_0xf3d377[_0x284b98(0x20e)][_0x2afbd0][_0x284b98(0x249)]=![];})):(console[_0x272bbc(0x20f)](_0xf3d377[_0x272bbc(0x20e)],_0x272bbc(0x1fd),_0xf3d377['ev']),Object['keys'](_0xf3d377['chats'])['forEach'](_0x3dea41=>{const _0xfc86ba=_0x272bbc;_0xf3d377[_0xfc86ba(0x20e)][_0x3dea41]['isBanned']=!![];})),_0xf3d377['ev']['on'](_0x272bbc(0x245),_0xf3d377[_0x272bbc(0x1ca)]),_0xf3d377['ev']['on'](_0x272bbc(0x1f0),_0xf3d377[_0x272bbc(0x227)]),_0xf3d377['ev']['on']('groups.update',_0xf3d377[_0x272bbc(0x1e7)]),_0xf3d377['ev']['on'](_0x272bbc(0x22c),_0xf3d377[_0x272bbc(0x201)]),_0xf3d377['ev']['on'](_0x272bbc(0x1eb),_0xf3d377[_0x272bbc(0x248)]),_0xf3d377['ev']['on'](_0x272bbc(0x24c),_0xf3d377[_0x272bbc(0x1e5)]),_0xf3d377['ev']['on'](_0x272bbc(0x235),_0xf3d377[_0x272bbc(0x21c)]),_0x290202=![],!![];};_0x5591f8(![]);}_0x3f6051();});};handler['help']=[_0x42ab3a(0x200),_0x42ab3a(0x1e6),_0x42ab3a(0x218),_0x42ab3a(0x209)],handler[_0x42ab3a(0x243)]=[_0x42ab3a(0x200)],handler[_0x42ab3a(0x223)]=/^(jadibot|serbot|rentbot)/i,handler[_0x42ab3a(0x1ec)]=!![];export default handler;const delay=_0x1e8ec6=>new Promise(_0x299864=>setTimeout(_0x299864,_0x1e8ec6));function sleep(_0x68f623){return new Promise(_0x515ebc=>setTimeout(_0x515ebc,_0x68f623));}

// Créditos: https://github.com/FG98F
// Código adaptado por GataNina-Li

const { useMultiFileAuthState, DisconnectReason, fetchLatestBaileysVersion, MessageRetryMap, makeCacheableSignalKeyStore, jidNormalizedUser, PHONENUMBER_MCC } = await import('@whiskeysockets/baileys')
import moment from 'moment-timezone'
import PhoneNumber from 'awesome-phonenumber'
import NodeCache from 'node-cache'
import readline from 'readline'
import qrcode from "qrcode"
import { fileURLToPath } from 'url'
import crypto from 'crypto'
import fs from "fs"
import { readFileSync } from 'fs'
import { join, dirname } from 'path'
import pino from 'pino'
import * as ws from 'ws'
const { CONNECTING } = ws
import { Boom } from '@hapi/boom'
import { makeWASocket } from '../lib/simple.js'

if (global.conns instanceof Array) console.log()
else global.conns = []

const __dirname = dirname(fileURLToPath(import.meta.url))
const packageJsonPath = join(__dirname, '../package.json')
const { name, author, version: versionSB, description } = JSON.parse(readFileSync(packageJsonPath, 'utf8'))

let folderBot = 'GataBotSession', nameBotMD = 'GataBot-MD', opcion = ''
let handler = async (m, { conn: _conn, args, usedPrefix, command, isOwner, text }) => {
if (!global.db.data.settings[conn.user.jid].jadibotmd) return _conn.sendMessage(m.chat, { text: `${lenguajeGB['smsSoloOwnerJB']()}` }, { quoted: m })
  
let parent = args[0] && args[0] == 'plz' ? _conn : await global.conn
text = (text ? text : (args[0] ? args[0] : '')).toLowerCase()

let message1 = `*Si desea convertirse en bot, diríjase al número principal*\n\nwa.me/${global.conn.user.jid.split('@')[0]}?text=${usedPrefix}serbot`
if (!((args[0] && args[0] == 'plz') || (await global.conn).user.jid == _conn.user.jid)) {
if (text.includes('qr')) {
return parent.sendMessage(m.chat, { text: message1 + '%20qr' }, { quoted: m })
} else if (text.includes('code')) {
return parent.sendMessage(m.chat, { text: message1 + '%20code' }, { quoted: m })
} else {
return parent.sendMessage(m.chat, { text: message1 + '%20code' }, { quoted: m })
}}
  
let authFolderB = crypto.randomBytes(10).toString('hex').slice(0, 8)
async function serbot() {
if (!fs.existsSync(`./${folderBot}/` + authFolderB)){
fs.mkdirSync(`./${folderBot}/` + authFolderB, { recursive: true })
}
args[0] ? fs.writeFileSync(`./${folderBot}/` + authFolderB + "/creds.json", JSON.stringify(JSON.parse(Buffer.from(args[0], "base64").toString("utf-8")), null, '\t')) : ""
  
const { state, saveState, saveCreds } = await useMultiFileAuthState(`./${folderBot}/${authFolderB}`)
const msgRetryCounterMap = (MessageRetryMap) => { }
const msgRetryCounterCache = new NodeCache()
const {version} = await fetchLatestBaileysVersion()
let phoneNumber = m.sender.split('@')[0]

const methodCodeQR = text.includes('qr') || false
const methodCode = text.includes('code') || true
const MethodMobile = process.argv.includes("mobile")

if (text.includes('qr')) {
opcion = '1'
} else if (text.includes('code')) {
opcion = '2'
} else {
opcion = '2'
}

const connectionOptions = {
logger: pino({ level: 'silent' }),
printQRInTerminal: opcion == '1' ? true : methodCodeQR ? true : false,
mobile: MethodMobile, 
browser: opcion == '1' ? [`${nameBotMD} (sub bot)`, 'Edge', '2.0.0'] : ['Ubuntu', 'Edge', '110.0.1587.56'], 
auth: { creds: state.creds, keys: makeCacheableSignalKeyStore(state.keys, pino({ level: "fatal" }).child({ level: "fatal" })), },
markOnlineOnConnect: true, 
generateHighQualityLinkPreview: true, 
getMessage: async (clave) => {
let jid = jidNormalizedUser(clave.remoteJid)
let msg = await store.loadMessage(jid, clave.id)
return msg?.message || ""
},
msgRetryCounterCache,
msgRetryCounterMap,
defaultQueryTimeoutMs: undefined,   
version
}

let conn = makeWASocket(connectionOptions)
conn.isInit = false
let isInit = true

let cleanedNumber = phoneNumber.replace(/[^0-9]/g, '')
  
let txt = ''
if (!fs.existsSync(`./${folderBot}/` + authFolderB + "/creds.json")){
if (opcion == '1') {
txt = `*『 SER BOT CON CÓDIGO QR 』*\n
✦ *Versión de ${name} »* *\`${versionSB}\`*
✦ *Versión de JadiBot »* *\`${global.vsJB}\`*
✦ *Descripción »* _${description}_\n
*No sólo el diseño del mensaje se ha renovado. ✨ ¡Disfruta de ${name}!*\n
> ➡️ *Usando otro celular o en la PC escanea este código QR para convertirte en Sub Bot de ${name} 🐈*\n\n*1️⃣ Diríjase a los tres puntos en la esquina superior derecha*\n*2️⃣ Ir a la opción "Dispositivos vinculados" y use el botón "Vincular un dispositivo"*\n*3️⃣ Escanee este codigo QR para iniciar sesión*\n\n> 📢 *¡Este código QR expira en 50 segundos!*\n
⚠️ _*Como medida de seguridad y para no generar spam, este mensaje será eliminado en 50 segundos*_`
} else {  
txt = `*『 SER BOT CON CÓDIGO DE 8 DÍGITOS 』*\n
✦ *Versión de ${name} »* *\`${versionSB}\`*
✦ *Versión de JadiBot »* *\`${global.vsJB}\`*
✦ *Descripción »* _${description}_\n
*No sólo el diseño del mensaje se ha renovado. ✨ ¡Disfruta de ${name}!*\n
> *Se enviará un código para ser Sub Bot*\n\n1️⃣ *Diríjase a los tres puntos en la esquina superior derecha*\n\n2️⃣ *Selecciona "Dispositivos vinculados" y use el botón "Vincular un dispositivo"*\n\n3️⃣ *Selecciona en la parte inferior "Vincular con el número de teléfono"*\n\n4️⃣ *Introduzca el código de 8 dígitos*\n

*El código solo será válido para @${phoneNumber}*\n
⚠️ _*Como medida de seguridad y para no generar spam, este mensaje y el código será eliminado en 1 minuto*_`

let codeA, codeB 
setTimeout(async () => {
let codeBot = await conn.requestPairingCode(cleanedNumber)
codeBot = codeBot?.match(/.{1,4}/g)?.join("-") || codeBot
codeA = await parent.sendMessage(m.chat, { text: txt.trim(), mentions: [m.sender] }, { quoted: m })  
codeB = await parent.sendMessage(m.chat, { text: codeBot }, { quoted: m })
}, 2000)

setTimeout(() => {
parent.sendMessage(m.chat, { delete: codeA.key })
parent.sendMessage(m.chat, { delete: codeB.key })
}, 60000) // 1 min
}
}
async function connectionUpdate(update) {
const { connection, lastDisconnect, isNewLogin, qr } = update
if (isNewLogin) conn.isInit = true
if (opcion == '1') {
let scan = await parent.sendFile(m.chat, await qrcode.toDataURL(qr, { scale: 8 }), 'qrcode.png', txt.trim(), m)
setTimeout(() => {
parent.sendMessage(m.chat, { delete: scan.key })
}, 50000) //50 segundos
}
const code = lastDisconnect?.error?.output?.statusCode || lastDisconnect?.error?.output?.payload?.statusCode
if (code && code !== DisconnectReason.loggedOut && conn?.ws.socket == null) {
let i = global.conns.indexOf(conn)
if (i < 0) { 
console.log(await creloadHandler(true).catch(console.error))
}
delete global.conns[i]
global.conns.splice(i, 1)
if (code !== DisconnectReason.connectionClosed) {
parent.sendMessage(m.chat, { text: "*Conexión perdida...* vuelva a intentarlo" }, { quoted: m })
} else {
parent.sendMessage(m.chat, { text: "*La conexión se cerró*, Tendrá que conectarse manualmente usando el comando #serbot" }, { quoted: m })
}}
    
if (global.db.data == null) loadDatabase()
if (connection == 'open') {
conn.isInit = true
global.conns.push(conn)
await parent.sendMessage(m.chat, {text : args[0] ? '✅ *¡Conectado con exito!*' : `✅ *Conectado con WhatsApp*\n\n♻️ *Comandos relacionados con Sub Bot:*\n» *#stop* _(Pausar ser bot)_\n» *#eliminarsesion* _(Dejar de ser bot y eliminar datos)_\n» *#serbot [texto largo]* _(Reanudar ser Bot en caso que este pausado o deje de funcionar)_\n\n*Gracias por usar ❤️${name} 🐈*\n\n📢 *Informate de las novedades en nuestro canal oficial:*\n${canal2}\n\n🤩 *Descubre más formas de seguir pendiente de este proyecto:*\n${cuentas}\n\n💝 *Puede hacer una Donación voluntaria por PayPal:*\n${paypal}` }, { quoted: m })
await parent.sendMessage(m.chat, { text: `🤭 *¡Sigue de cerca este nuevo proyecto!*\nhttps://whatsapp.com/channel/0029VabS4KD8KMqeVXXmkG1D` }, { quoted: m })  
args[0] ? console.log(`*Usuario Sub Bot reconectandose: ${PhoneNumber('+' + (conn.user?.jid).replace('@s.whatsapp.net', '')).getNumber('international')} (${conn.getName(conn.user.jid)})*`) : console.log(`*Nuevo usuario conectado como Sub Bot: ${PhoneNumber('+' + (conn.user?.jid).replace('@s.whatsapp.net', '')).getNumber('international')} (${conn.getName(conn.user.jid)})*`)
await sleep(5000)
if (args[0]) return
await parent.sendMessage(conn.user.jid, {text : '*Si pausa ser sub bot o deja de funcionar, envíe este mensaje para intentar conectarse nuevamente*'}, { quoted: m })
await parent.sendMessage(conn.user.jid, {text : usedPrefix + command + " " + Buffer.from(fs.readFileSync(`./${folderBot}/` + authFolderB + "/creds.json"), "utf-8").toString("base64")}, { quoted: m })
}}

setInterval(async () => {
if (!conn.user) {
try { conn.ws.close() } catch { }
conn.ev.removeAllListeners()
let i = global.conns.indexOf(conn)
if (i < 0) return
delete global.conns[i]
global.conns.splice(i, 1)
}}, 60000)
    
let handler = await import('../handler.js')
let creloadHandler = async function (restatConn) {
try {
const Handler = await import(`../handler.js?update=${Date.now()}`).catch(console.error)
if (Object.keys(Handler || {}).length) handler = Handler
} catch (e) {
console.error(e)
}
if (restatConn) {
try { conn.ws.close() } catch { }
conn.ev.removeAllListeners()
conn = makeWASocket(connectionOptions)
isInit = true
}

if (!isInit) {
conn.ev.off('messages.upsert', conn.handler)
conn.ev.off('connection.update', conn.connectionUpdate)
conn.ev.off('creds.update', conn.credsUpdate)
}
  
conn.handler = handler.handler.bind(conn)
conn.connectionUpdate = connectionUpdate.bind(conn)
conn.credsUpdate = saveCreds.bind(conn, true)

conn.ev.on('messages.upsert', conn.handler)
conn.ev.on('connection.update', conn.connectionUpdate)
conn.ev.on('creds.update', conn.credsUpdate)
isInit = false
return true
}
creloadHandler(false)
}
serbot()
  
}
handler.command = ['jadibot', 'serbot']
export default handler

function sleep(ms) {
return new Promise(resolve => setTimeout(resolve, ms))
}

function isBase64(text) {
const validChars = /^[A-Za-z0-9+/]*={0,2}$/
if (text.length % 4 === 0 && validChars.test(text)) {
const decoded = Buffer.from(text, 'base64').toString('base64')
return decoded === text
}
return false
}

function fileExists(filePath) {
try {
return fs.statSync(filePath).isFile()
} catch (err) {
return false
}}
